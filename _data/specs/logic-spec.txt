1) meters.csv (maestro de contadores)

Campos (obligatorios)

meterId (string, PK) — código del contador (ej. MTR0001)

cups (string, opcional) — identificador del punto de suministro

address (string)

postalCode (string)

city (string)

Ejemplo

meterId,cups,address,postalCode,city
MTR0001,ES0021000000000001,C/ Mayor 10,46001,Valencia
MTR0002,ES0021000000000002,Av. Aragón 55,46021,Valencia

Validaciones mínimas

meterId no vacío, único.

postalCode 5 dígitos (opcional para el workshop, pero útil).

2) contracts.csv (contrato por contador + persona)

Campos

contractId (string, PK)

meterId (FK → meters.meterId)

customerId (string)

fullName (string)

nif (string)

email (string)

contractType (enum): FLAT | FIXED

startDate (YYYY-MM-DD)

endDate (YYYY-MM-DD o vacío)

billingCycle (enum): MONTHLY

flatMonthlyFeeEur (decimal, requerido si FLAT)

includedKwh (decimal, requerido si FLAT)

overagePricePerKwhEur (decimal, requerido si FLAT)

fixedPricePerKwhEur (decimal, requerido si FIXED)

taxRate (decimal, requerido) — ej. 0.21

iban (string)

Ejemplo

contractId,meterId,customerId,fullName,nif,email,contractType,startDate,endDate,billingCycle,flatMonthlyFeeEur,includedKwh,overagePricePerKwhEur,fixedPricePerKwhEur,taxRate,iban
CONT001,MTR0001,CUST001,Ana Pérez Gómez,12345678Z,ana.perez@email.com,FIXED,2025-01-01,,MONTHLY,,,,0.19,0.21,ES6621000418401234567891
CONT002,MTR0002,CUST002,Roberto García Palop,87654321X,roberto@email.com,FLAT,2025-06-01,,MONTHLY,45.00,200,0.28,,0.21,ES6621000418409876543210

Reglas de consistencia (muy importantes)

Si contractType=FIXED:

fixedPricePerKwhEur obligatorio

flatMonthlyFeeEur, includedKwh, overagePricePerKwhEur vacíos

Si contractType=FLAT:

flatMonthlyFeeEur, includedKwh, overagePricePerKwhEur obligatorios

fixedPricePerKwhEur vacío

Debe existir meterId en meters.csv.

Debe haber 1 contrato activo por meterId en el periodo (para simplificar).

3) readings.csv (medidas horarias)

Campos

meterId (FK → meters.meterId)

date (YYYY-MM-DD)

hour (0-23)

kwh (decimal >= 0)

quality (enum opcional): REAL | ESTIMATED

Ejemplo

meterId,date,hour,kwh,quality
MTR0001,2026-01-01,0,0.45,REAL
MTR0001,2026-01-01,1,0.40,REAL
MTR0001,2026-01-01,2,0.38,REAL
MTR0002,2026-01-01,0,0.60,ESTIMATED
MTR0002,2026-01-01,1,0.55,REAL

Validaciones mínimas

meterId debe existir en meters.csv

hour en [0..23]

kwh >= 0

Duplicados: mismo meterId + date + hour

decisión workshop recomendada: error 400 (más fácil de explicar y testear)

Reglas de cálculo (solo A y B)
A) FIXED

totalKwh = sum(kwh del mes para meterId)

energy = totalKwh * fixedPricePerKwhEur

subtotal = energy

tax = subtotal * taxRate

total = subtotal + tax

B) FLAT

totalKwh = sum(kwh del mes para meterId)

base = flatMonthlyFeeEur

overageKwh = max(0, totalKwh - includedKwh)

overage = overageKwh * overagePricePerKwhEur

subtotal = base + overage

tax = subtotal * taxRate

total = subtotal + tax

Rounding recomendado (para consistencia)

Dinero: 2 decimales, HALF_UP

kWh: puedes dejar 2–3 decimales (o sumar como BigDecimal y mostrar 2)

Sugerencia práctica para el workshop (para que no se líen con periodos)

Facturas por meterId + YYYY-MM

El backend recibe period=2026-01

Filtra lecturas por date dentro del mes

Si quieres, te paso también un set de samples de readings.csv que cubra:

un FIXED sin excedentes

un FLAT con excedente (para que se vea el overage)

un caso de error (duplicado hora) para demo de validación y tests